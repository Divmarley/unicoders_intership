{% extends 'accounts/main/base.html' %}
{% load static %}
{% block title %}{{ title }}{% endblock title %}</title>
{% block content %}
<div class="container-fluid">
                <!-- ============================================================== -->
                <!-- Bread crumb and right sidebar toggle -->
                <!-- ============================================================== -->
                {% include 'accounts/main/partials/bread_crumb.html' %}
                <!-- ============================================================== -->
                <!-- End Bread crumb and right sidebar toggle -->
                <!-- ============================================================== -->
                <!-- ============================================================== -->
                <!-- Start Page Content -->
                <!-- ============================================================== -->
                <!-- Row -->
                <div class="row">
                    <!-- Column -->
                    <div class="col-lg-4 col-xlg-3 col-md-5">
                        <div class="card">
                            <div class="card-body">
                                <center class="m-t-30"> <img src="{% if profile.image %} {{ profile.image.url }} {% else %} {% static 'main/assets/images/user4-128x128.jpg' %} {% endif %}" class="img-circle" width="150" height="150"/> 
                                    <div class="text-center" style="margin-left: 4rem; color: rgb(190, 130, 16); cursor:pointer"> 
                                        <span onclick="getFile();">
                                            <i class="fa fa-camera">
                                            <div style='height: 0px;width:0px; overflow:hidden;'><input id="upfile" type="file" name="image" data-token="{{csrf_token}}" data-href="{% url 'account:change-profile-image' profile.id %}" /></div>
                                            </i>
                                        </span> 
                                    </div>
                                    <h4 class="card-title m-t-10">{{profile.name}}</h4>
                                    <h6 class="card-subtitle">{{profile.user_id.user_type}}</h6>
                                    <div class="row text-center justify-content-md-center">
                                        <div class="col-6"><a href="javascript:void(0)" class="link"><i class="icon-people"></i> <font class="font-medium">254</font></a></div>
                                        <div class="col-6"><a href="javascript:void(0)" class="link"><i class="icon-picture"></i> <font class="font-medium">54</font></a></div>
                                    </div>
                                </center>
                            </div>
                            <div>
                                <hr> </div>
                            <div class="card-body"> <small class="text-muted">Email address </small>
                                <h6>{{profile.user_id.email}}</h6> <small class="text-muted p-t-30 db">Phone</small>
                                <h6>{{profile.phone }}</h6> <small class="text-muted p-t-30 db">Address</small>
                                <h6>{{profile.address }}</h6>
                                <div class="map-box">
                                    <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d470029.1604841957!2d72.29955005258641!3d23.019996818380896!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x395e848aba5bd449%3A0x4fcedd11614f6516!2sAhmedabad%2C+Gujarat!5e0!3m2!1sen!2sin!4v1493204785508" width="100%" height="150" frameborder="0" style="border:0" allowfullscreen></iframe>
                                </div> <small class="text-muted p-t-30 db">Social Profile</small>
                                <br/>
                                {% for x in social_media_link %}
                                <a href={{x.link }} class="btn btn-circle btn-secondary"><i class="fab fa-{{x.social_media_field }}"></i></a>
                                {% endfor %} 
                                    <button type="button" class="btn btn-info text-white" data-bs-toggle="modal" data-bs-target="#exampleModal" data-whatever="@mdo"><i class="ti-plus"></i></button>
                                    <div class="modal" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel1">
                                        <div class="modal-dialog" role="document">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h4 class="modal-title" id="exampleModalLabel1">Add social media account</h4>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"><span aria-hidden="true"></span></button>
                                                </div>
                                                <div class="modal-body">
                                                    <form action="{% url 'account:create-social-link' %}" method="post" id="createSocialLink"> 
                                                        {% csrf_token %} 
                                                       
                                                        <div class="form-group has-success"> 
                                                            <select class="form-control form-select" name="social_media_field">
                                                                <option value="">--Select Social media Type--</option>
                                                                <option value="facebook">facebook</option>
                                                                <option value="linkedin">linkedin</option>
                                                                <option value="instagram">instagram</option>
                                                                <option value="twitter">twitter</option> 
                                                            </select>
                                                            {% comment %} <small class="form-control-feedback"> Select your gender </small>  {% endcomment %}
                                                          </div>
                                                        <div class="form-group">
                                                            <label for="message-text" class="form-label">link:</label>
                                                            <textarea class="form-control" name="link" id="message-text1" placeholder="paste your link here"></textarea>
                                                        </div>
                                                        <div class="modal-footer">
                                                            <button type="button" class="btn btn-default" data-bs-dismiss="modal">Close</button>
                                                            <button type="submit" class="btn btn-primary text-white btnsubmit">Add</button>
                                                        </div>
                                                    </form>
                                                </div>
                                                
                                            </div>
                                        </div>
                                    </div>
                            </div>
                        </div>
                    </div>
                    <!-- Column -->
                    <!-- Column -->
                    <div class="col-lg-8 col-xlg-9 col-md-7">
                        <div class="card">
                            <!-- Nav tabs -->
                            <ul class="nav nav-tabs profile-tab" role="tablist">
                                <li class="nav-item"> <a class="nav-link active" data-bs-toggle="tab" href="#home" role="tab">Timeline</a> </li>
                                <li class="nav-item"> <a class="nav-link" data-bs-toggle="tab" href="#profile" role="tab">Profile</a> </li>
                                <li class="nav-item"> <a class="nav-link" data-bs-toggle="tab" href="#settings" role="tab">Settings</a> </li>
                                <li class="nav-item"> <a class="nav-link" data-bs-toggle="tab" href="#changepassword" role="tab">Change Password</a> </li>
                            </ul>
                            <!-- Tab panes -->
                            <div class="tab-content">
                                <div class="tab-pane active" id="home" role="tabpanel">
                                    <div class="card-body">
                                        <div class="profiletimeline">
                                            <div class="sl-item">
                                                <div class="sl-left"> <img src="../assets/images/users/1.jpg" alt="user" class="img-circle" /> </div>
                                                <div class="sl-right">
                                                    <div><a href="javascript:void(0)" class="link">John Doe</a> <span class="sl-date">5 minutes ago</span>
                                                        <p>assign a new task <a href="javascript:void(0)"> Design weblayout</a></p>
                                                        <div class="row">
                                                            <div class="col-lg-3 col-md-6 m-b-20"><img src="../assets/images/big/img1.jpg" class="img-responsive radius" /></div>
                                                            <div class="col-lg-3 col-md-6 m-b-20"><img src="../assets/images/big/img2.jpg" class="img-responsive radius" /></div>
                                                            <div class="col-lg-3 col-md-6 m-b-20"><img src="../assets/images/big/img3.jpg" class="img-responsive radius" /></div>
                                                            <div class="col-lg-3 col-md-6 m-b-20"><img src="../assets/images/big/img4.jpg" class="img-responsive radius" /></div>
                                                        </div>
                                                        <div class="like-comm"> <a href="javascript:void(0)" class="link m-r-10">2 comment</a> <a href="javascript:void(0)" class="link m-r-10"><i class="fa fa-heart text-danger"></i> 5 Love</a> </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <hr>
                                            <div class="sl-item">
                                                <div class="sl-left"> <img src="../assets/images/users/2.jpg" alt="user" class="img-circle" /> </div>
                                                <div class="sl-right">
                                                    <div> <a href="javascript:void(0)" class="link">John Doe</a> <span class="sl-date">5 minutes ago</span>
                                                        <div class="m-t-20 row">
                                                            <div class="col-md-3 col-xs-12"><img src="../assets/images/big/img1.jpg" alt="user" class="img-responsive radius" /></div>
                                                            <div class="col-md-9 col-xs-12">
                                                                <p> Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer nec odio. Praesent libero. Sed cursus ante dapibus diam. </p> <a href="javascript:void(0)" class="btn btn-success text-white"> Design weblayout</a></div>
                                                        </div>
                                                        <div class="like-comm m-t-20"> <a href="javascript:void(0)" class="link m-r-10">2 comment</a> <a href="javascript:void(0)" class="link m-r-10"><i class="fa fa-heart text-danger"></i> 5 Love</a> </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <hr>
                                            <div class="sl-item">
                                                <div class="sl-left"> <img src="../assets/images/users/3.jpg" alt="user" class="img-circle" /> </div>
                                                <div class="sl-right">
                                                    <div><a href="javascript:void(0)" class="link">John Doe</a> <span class="sl-date">5 minutes ago</span>
                                                        <p class="m-t-10"> Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer nec odio. Praesent libero. Sed cursus ante dapibus diam. Sed nisi. Nulla quis sem at nibh elementum imperdiet. Duis sagittis ipsum. Praesent mauris. Fusce nec tellus sed augue semper </p>
                                                    </div>
                                                    <div class="like-comm m-t-20"> <a href="javascript:void(0)" class="link m-r-10">2 comment</a> <a href="javascript:void(0)" class="link m-r-10"><i class="fa fa-heart text-danger"></i> 5 Love</a> </div>
                                                </div>
                                            </div>
                                            <hr>
                                            <div class="sl-item">
                                                <div class="sl-left"> <img src="../assets/images/users/4.jpg" alt="user" class="img-circle" /> </div>
                                                <div class="sl-right">
                                                    <div><a href="javascript:void(0)" class="link">John Doe</a> <span class="sl-date">5 minutes ago</span>
                                                        <blockquote class="m-t-10">
                                                            Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt
                                                        </blockquote>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                 
                                <!--second tab-->
                                <div class="tab-pane" id="profile" role="tabpanel">
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-3 col-xs-6 b-r"> <strong>Full Name</strong>
                                                <br>
                                                <p class="text-muted">{{profile.name}}</p>
                                            </div>
                                            <div class="col-md-3 col-xs-6 b-r"> <strong>Mobile</strong>
                                                <br>
                                                <p class="text-muted">{{profile.phone}}</p>
                                            </div>
                                            <div class="col-md-3 col-xs-6 b-r"> <strong>Email</strong>
                                                <br>
                                                <p class="text-muted">{{request.user.email}}</p>
                                            </div>
                                            <div class="col-md-3 col-xs-6"> <strong>Location</strong>
                                                <br>
                                                <p class="text-muted">{{profile.location}}</p>
                                            </div>
                                        </div>
                                        <hr>
                                        <p class="m-t-30">{{profile.bio}}</p>
                                        <h4 class="font-medium m-t-30">Skill Set  <button  class="btn btn-info text-white pull-left" data-bs-toggle="modal" data-bs-target="#addSkillModal" data-whatever="@mdo">add</i></button>
                                            <div class="modal" id="addSkillModal" tabindex="-1" role="dialog" aria-labelledby="addSkillModalLabel1">
                                                <div class="modal-dialog" role="document">
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <h4 class="modal-title" id="addSkillModalLabel1">Add Skill set</h4>
                                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"><span aria-hidden="true"></span></button>
                                                        </div>
                                                        <div class="modal-body">
                                                            <form action="{% url 'account:create-skill' %}" method="post" id="addSkill"> 
                                                                {% csrf_token %} 
                                                                
                                                                
                                                                <div class="form-group">
                                                                    <label for="message-text" class="form-label">link:</label>
                                                                    <input class="form-control" name="name" id="message-text1" placeholder="name"> 
                                                                </div>
                                                                
                                                                <div class="form-group has-success"> 
                                                                    <select class="form-control form-select" name="rating">
                                                                        <option value="">--Select Social media Type--</option>
                                                                        <option value="10">10%</option>
                                                                        <option value="linkedin">linkedin</option>
                                                                        <option value="instagram">instagram</option>
                                                                        <option value="twitter">twitter</option> 
                                                                    </select> 
                                                                  </div> 
                                                                <div class="modal-footer">
                                                                    <button type="button" class="btn btn-default" data-bs-dismiss="modal">Close</button>
                                                                    <button type="submit" class="btn btn-primary text-white btnsubmit">Add</button>
                                                                </div>
                                                            </form>
                                                        </div>
                                                        
                                                    </div>
                                                </div>
                                            </div>
                                        </h4>
                                        <hr>
                                        {% for skillset in skillset %}
                                        <h5 class="m-t-30">{{skillset.name}} <span class="pull-right">{{skillset.rating}}%</span></h5>
                                        <div class="progress">
                                            <div class="progress-bar bg-success" role="progressbar" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100" style="width:{{skillset.rating}}%; height:6px;"> <span class="sr-only">50% Complete</span> </div>
                                        </div>
                                        
                                        {% endfor %}
                                        <!-- <h5 class="m-t-30">HTML 5 <span class="pull-right">90%</span></h5>
                                        <div class="progress">
                                            <div class="progress-bar bg-info" role="progressbar" aria-valuenow="90" aria-valuemin="0" aria-valuemax="100" style="width:90%; height:6px;"> <span class="sr-only">50% Complete</span> </div>
                                        </div>
                                        <h5 class="m-t-30">jQuery <span class="pull-right">50%</span></h5>
                                        <div class="progress">
                                            <div class="progress-bar bg-danger" role="progressbar" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100" style="width:50%; height:6px;"> <span class="sr-only">50% Complete</span> </div>
                                        </div>
                                        <h5 class="m-t-30">Photoshop <span class="pull-right">70%</span></h5>
                                        <div class="progress">
                                            <div class="progress-bar bg-warning" role="progressbar" aria-valuenow="70" aria-valuemin="0" aria-valuemax="100" style="width:70%; height:6px;"> <span class="sr-only">50% Complete</span> </div>
                                        </div> -->
                                    </div>
                                </div>
                                <div class="tab-pane" id="settings" role="tabpanel">
                                    <div class="card-body">
                                        <form class="form-horizontal form-material" method="post" action="">
                                            {%csrf_token%}
                                            <!-- <input type="text" value="8" class="form-control form-control-line" name="user"> -->
                                            
                                            <div class="form-group">
                                                <label class="col-md-12">Full Name </label>
                                                <div class="col-md-12">
                                                    <input type="text" placeholder="{{profile.name}}" value="{{profile.name}}" class="form-control form-control-line" name="name">
                                                </div>
                                            </div>
                                            <!-- <div class="form-group">
                                                <label for="example-email" class="col-md-12">Email</label>
                                                <div class="col-md-12">
                                                    <input type="email" placeholder="johnathan@admin.com" class="form-control form-control-line" name="example-email" id="example-email">
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-md-12">Password</label>
                                                <div class="col-md-12">
                                                    <input type="password" value="password" name="" class="form-control form-control-line">
                                                </div>
                                            </div> -->
                                            <div class="form-group">
                                                <label class="col-md-12">Phone No</label>
                                                <div class="col-md-12">
                                                    <input type="text"  placeholder="{{profile.phone}}" value="{{profile.phone}}" name="phone" class="form-control form-control-line">
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-sm-12">Select Gender</label>
                                                <div class="col-sm-12">
                                                    <select class="form-control form-control-line"  value="{{profile.gender}}"  name="gender">
                                                        <option value="m">Male</option>
                                                        <option  value="f">Female</option> 
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-md-12">Bio</label>
                                                <div class="col-md-12">
                                                    <textarea rows="5" name="bio"  value="{{profile.bio}}"  class="form-control form-control-line"></textarea>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-md-12">Address</label>
                                                <div class="col-md-12">
                                                    <textarea rows="3" name="address"  value="{{profile.address}}" class="form-control form-control-line"></textarea>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-sm-12">Select Location</label>
                                                <div class="col-sm-12">
                                                    <select class="form-control form-control-line" name="location">
                                                        <option value="accra">Accra</option>
                                                        <option  value="ksi">Kumasi</option> 
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <div class="col-sm-12">
                                                    <button class="btn btn-success text-white">Update Profile</button>
                                                    <button id="btn">Trial</button>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                                <div class="tab-pane" id="changepassword" role="tabpanel">
                                    <div class="card-body">
                                        <form class="form-horizontal form-material" method="post"  id="formChangePassword" action="{% url 'account:change-password' %}">
                                            {%csrf_token%}
                                           
                                            
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Column -->
                </div>
                <!-- Row -->
                <!-- ============================================================== -->
                <!-- End PAge Content -->
                <!-- ============================================================== -->
                <!-- ============================================================== -->
                <!-- Right sidebar -->
                <!-- ============================================================== -->
                <!-- .right-sidebar -->
                 
                <!-- ============================================================== -->
                <!-- End Right sidebar -->
                <!-- ============================================================== -->
            </div>

{% endblock content %}
{% block scripts %}
<!-- {% comment %} <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script> {% endcomment %} -->
<script src="{% static 'main/assets/node_modules/sweetalert2/dist/sweetalert2.all.min.js'%}"></script>
<script src="{% static 'main/assets/node_modules/sweetalert2/sweet-alert.init.js'%}"></script> 
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
<script>
    $("#createSocialLink").on("submit", function(e){
        e.stopPropagation();
        e.preventDefault();
        var $this = $(this);
        var valid = true;
        $('#createSocialLink input').each(function() {
            let $this = $(this);
            
            if(!$this.val()) {
                valid = false;
                $this.parents('.validate').find('.mySpan').text('The '+$this.attr('name').replace(/[\_]+/g, ' ')+' field is required');
            }
        });
    
        if(valid){
            $("#createSocialLink .btnsubmit").html('<i class="fa fa-spin fa-spinner"></i> Submitting...').attr('disabled',true);
            let data = $this.serialize();
            console.log(data);
            // alert(".bjdsbfjbsd")
            $.ajax({
                url: $("#createSocialLink").attr("action"),
                type: "POST",
                dateType: "json",
                data: data,
                // headers: { 'X-CSRFToken': $('input[name="csrfmiddlewaretoken"]').val() },
                headers: {
                    "X-Requested-With": "XMLHttpRequest",
                    //"X-CSRFToken": getCookie("csrftoken"),
                  },

                success: function(resp){
                    if(resp.message==='success'){
                        window.location.reload();
                        // swal({
                        //     title: "Are you sure?",
                        //     text: "Once deleted, you will not be able to recover this imaginary file!",
                        //     icon: "warning",
                        //     buttons: true,
                        //     dangerMode: true,
                        //     },
                            
                        //     );
                    }else{
                        if(resp.message.link){
                            swal('Error', `${resp.message.link}`, 'warning');
                        }else{
                            swal('Error', `${resp.message}`, 'warning');
                        }
                    }
                    $("#createSocialLink .btnsubmit").html('Submit <i class="icon-paperplane ml-2"></i>').attr('disabled',false);
                },
                error: function(resp){
                    console.log('something wrong with request')
                    $("#createSocialLink .btnsubmit").html('Submit <i class="icon-paperplane ml-2"></i>').attr('disabled',false);
                }
            });
        }
        return false;
    });



    function getFile(){
    document.getElementById('upfile').click();
}
$("#upfile").on("change", function(){
    var form_data = new FormData(); 
    var size = document.getElementById('upfile').files[0].size;
    var selectedFile = document.getElementById('upfile').files[0].name;
    var ext = selectedFile.replace(/^.*\./, '');
    ext= ext.toLowerCase();
    if(size>1000141){
        swal("Opps", "Uploaded file is greater than 1mb.", "error");
        document.getElementById("upfile").value = null;
    }
    else if(ext!='jpg' && ext!='jpeg' && ext!='png'){
        swal("Opps", "Unknown file types.", "error");
        document.getElementById("upfile").value = null;
    }
    else{
        form_data.append("image", document.getElementById('upfile').files[0]);
        form_data.append("csrfmiddlewaretoken", $("#upfile").data('token'))
        $.ajax({
            url: $("#upfile").data('href'), 
            type: 'POST',
            data: form_data,
            dataType: 'json',
            contentType: false,
            processData: false,
            success: function (response) {
                if(response.message=='success'){
                    let src = $(".img_preview").data('preview');
                    $(".img_preview").attr("src", response.img); 
                    window.location.reload();
                }
                else{
                    swal("Opps", JSON.stringify(response.message), "warning");
                }
                document.getElementById("upfile").value = null;
            },
            error: function(response){
                alert(response.message);
                document.getElementById("upfile").value = null;
            }
            
        });
    }
    
    return false;
});
    
  </script>
{% endblock scripts %}



 